<!DOCTYPE html>
<html>
	<head>

		<meta charset="UTF-8">

		<meta name="description" content="CS490 Project">
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="language" content="english">

		<link rel="stylesheet" href="style_instructor_questionCreate.css">
		
		<script type="text/javascript" src="front.js"></script>

		<title>CS490 Project - Instructor</title>
		
	</head>
	<body>
		<script>
		
			CheckLogin("instructor");
			
			
			
			// Question Creation Scripts
			function SendQuestion() {
				var question_textVal = document.getElementById("question").value;
				var difficultyVal = document.getElementById("difficulty").value;
				var topicVal = document.getElementById("topic").value;
				
				var requirementsVal = "";
				for(e of document.getElementsByName("requirement")){
					if(e.checked == true){
						requirementsVal += e.value + ","
					}
				}
				if(requirementsVal.length > 0){
					requirementsVal = requirementsVal.substring(0, requirementsVal.length -1);
				}
				
				var outputVal = document.getElementById("output").value;
				
				// Arguments and Test_Cases
				var argumentsVal = "";
				var test_casesVal = "";
				if(document.getElementById("needNumArgs").checked == true){
					for(e of document.getElementsByName("argName")){
						argumentsVal += e.value + ",";
					}
					if(argumentsVal.length > 0){
						argumentsVal = argumentsVal.substring(0, argumentsVal.length -1);
					}
					
					for(e of document.getElementsByName("testCase")){
						for (eChild of e.childNodes){
							console.log(eChild.nodeName);
							if(eChild.nodeName == "INPUT"){
								test_casesVal += eChild.value + "==";
							}
						}
						if(test_casesVal.length > 0){
							test_casesVal = test_casesVal.substring(0, test_casesVal.length -2);
						}
						test_casesVal += ":";
					}
					if(test_casesVal.length > 0){
						test_casesVal = test_casesVal.substring(0, test_casesVal.length -1);
					}
				}				
				
				
				var sendStr =
					"question_text=" + question_textVal +
					"&difficulty=" + difficultyVal + 
					"&topic=" + topicVal +
					"&requirements=" + requirementsVal +
					"&output=" + outputVal +
					"&arguments=" + argumentsVal +
					"&test_cases=" + test_casesVal;
				
				console.log(sendStr);
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function(){
					if(this.readyState == 4 && this.status == 200){
						console.log(this.responseText);
						console.log("Reset!");
						document.getElementById("questionForm").reset();
						// Likely a better way to add that one question to bank...
						GetAllQuestions();
					}
				}
				xhttp.open("POST","http://afsaccess4.njit.edu/~lta2/CS490/middlebetaTQ.php",true);
				xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
				xhttp.send(sendStr);
      }
			
			
			
			
			
			function mustCheckArgs (elem){
				var numArgs = elem.selectedIndex+1;
				var argTextBox = '<input name="argName" type="text"><br>';
				document.getElementById("argNames").innerHTML = argTextBox.repeat(numArgs);
				// Should change the number of text boxes for each test case?
			}
			
			function test3(theCB){
				var content = theCB.nextElementSibling.nextElementSibling;
				if(content.style.display === "block" && !theCB.checked){
					content.style.display = "none";
				}else{
					content.style.display = "block";
				}
			}
			
			//
			//
			//
			//
			// Exam Creation Scripts
			function GetAllQuestions(){
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function(){
					if(this.readyState == 4 && this.status == 200){
						console.log(this.responseText);
						console.log("Attempted to send!");
						if(this.responseText == "examData not set"){
							return;
						}
						var questionBank = this.responseText.split("~");
						questionBank.pop();
						console.log(questionBank);
						for(question of questionBank){
							
							console.log(question);
							var questionArray = question.split("\n");
							var newQuestionID = questionArray[0];
							// There's probably a better way...
							if(document.getElementById(newQuestionID)){
								continue;
							}
							
							console.log(questionArray);
							document.getElementById("queriedQuestions").innerHTML += "<br>";
							document.getElementById("queriedQuestions").innerHTML += "<div name='question' id='placeholderID'></div>";
							
							document.getElementById("placeholderID").id = newQuestionID;
							document.getElementById(newQuestionID).innerHTML += "<input id='questionCheck' type='checkbox' onchange='UpdateTotal()'>";
							document.getElementById(newQuestionID).innerHTML += "<p>"+questionArray[1]+"<p>";
							document.getElementById(newQuestionID).innerHTML += "<p>Difficulty: "+questionArray[2]+"<p>";
							document.getElementById(newQuestionID).innerHTML += "<p>Topic: "+questionArray[3]+"<p>";
							document.getElementById(newQuestionID).innerHTML += "<p>Requirements: "+questionArray[4]+"<p>";
							document.getElementById(newQuestionID).innerHTML += "<p>Arguments: "+questionArray[5]+"<p>";
							document.getElementById(newQuestionID).innerHTML += "<p>Output Type: "+questionArray[6]+"<p>";
							document.getElementById(newQuestionID).innerHTML += "Assign Point Value: <input id='questionPoints' type='text' required pattern='[0-9]{1,3}' onchange='UpdateTotal()'>";
							document.getElementById(newQuestionID).innerHTML += "<br><br>";
						}
						
						QueryQuestions(document.getElementById("questionSearchBox").value);
						
					}
				}
				xhttp.open("POST","http://afsaccess4.njit.edu/~lta2/CS490/middlebetaTA.php",true);
				xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
				xhttp.send();
      }
			
			GetAllQuestions();
			
			function SubmitExam(){

				var examData = ""
				for(e of document.getElementsByName("question")){
					console.log(e.childNodes);
					if(e.childNodes[0].checked == true){
						if(!Number.isInteger(parseInt(e.childNodes[14].value))){
							document.getElementById("words").innerHTML = "All point values must be assigned correctly!";
							return;
						}
						examData += e.id + "," + e.childNodes[14].value + ":";
					}
				}
				if(examData.length > 0){
					examData = examData.substring(0, examData.length -1);
				}				
				
				//examData += "*" + document.getElementById("totalPoints").innerHTML;
				var sendStr = "exam=" + examData;
				console.log(sendStr);
				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function(){
					if(this.readyState == 4 && this.status == 200){
						console.log("Attempted to send!")
						console.log(this.responseText);
						if(this.responseText != "invalid_form"){
							console.log("Reset!");
							document.getElementById("examForm").reset();
							QueryQuestions("");
							document.getElementById("totalPoints").innerHTML = 0;
						}
					}
				}
				xhttp.open("POST","http://afsaccess4.njit.edu/~lta2/CS490/middlebetaTE.php",true);
				xhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
				xhttp.send(sendStr);
			}
			
			function UpdateTotal(){
				var newTotal = 0;
				for(e of document.getElementsByName("question")){
					if(e.childNodes[0].checked == true){
						var pointValue = parseInt(e.childNodes[14].value);
						if(Number.isInteger(pointValue)){
							newTotal += pointValue;
						}
					}
				}
				document.getElementById("totalPoints").innerHTML = newTotal;
			}
			
			function QueryQuestions(strToSearch){
				console.log("Should update show/hide questions...");
				for(e of document.getElementsByName("question")){
					if(e.innerHTML.search(strToSearch) == -1){
						e.style.display = "none"
					}else{
						e.style.display = "block";
					}
				}
			}
			
			
			window.onload = function(){
				document.getElementById("backButton").onclick = function () {
					window.location.href = "http://afsaccess4.njit.edu/~jaa75/cs490/instructor_start.html";
				};
			}
			
			
		</script>
		
	
		<form id="questionForm" action="">
		
			<button type="button" id="backButton">Back to Start Page</button>
			
			<div class="split left">
				<div class="centered">
					<h1>Question Creation</h1>
					<br>
					<br>
				
					<!-- Question Creation -->
					<div>
						<label for="title">Question Title:</label>
						<br>
						<input type="text" id="title">
						<br>
						
						<label for="question">Enter Question:</label>
						<br>
						<textarea id="question" rows="16" cols="80" required></textarea>
						<br>
						<br>

						<label for="difficulty">Difficulty</label>
						<br>
						<select id="difficulty">
							<option value="easy">Easy</option>
							<option value="medium">Medium</option>
							<option value="hard">Hard</option>
						</select>
						<br>
						<br>
						
						<!-- CHANGING SOON -->
						<label for="topic">Topics</label>
						<br>
						<select id="topic">
							<option value="dictionary">Dictionaries</option>
							<option value="array">Arrays</option>
							<option value="string">Strings</option>
							<option value="condition">Conditionals</option>
							<option value="turtle">Turtle</option>
							<option value="loop">Loops</option>
						</select>
						<br>
						<br>
						
						
						<label for="">Requirements</label>
						<br>
						
						<input type="checkbox" name="requirement" id="reqDict" value="dictionary"><label for="reqDict">Dictionary</label>
						<br>
						<input type="checkbox" name="requirement" id="reqArr" value="array"><label for="reqArr">Array</label>
						<br>
						<input type="checkbox" name="requirement" id="reqCond" value="conditional"><label for="reqCond">Conditional</label>
						<br>
						<input type="checkbox" name="requirement" id="reqTurt" value="turtle"><label for="reqTurt">Turtle</label>
						<br>
						<input type="checkbox" name="requirement" id="reqFor" value="forLoop"><label for="reqFor">For Loop</label>
						<br>
						<input type="checkbox" name="requirement" id="reqWhile" value="whileLoop"><label for="reqWhile">While Loop</label>
						<br>
						<br>
						
						
						<!-- CHANGING SOON -->
						<label for="output">Output</label>
						<br>
						<select id="output">
							<option value="return">Return</option>
							<option value="print">Print</option>
						</select>
						<br>
						<br>
						
						<input type="checkbox" name="needNumArgs" id="needNumArgs" value="needNumArgs">
						Number of arguments
						<select onchange="mustCheckArgs(this)">
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
						</select>
						
						<br>
						<label for="argNames">Argument Names</label>
						<div id="argNames">
							<input name="argName" type="text"><br>
						</div>
					</div>
					
					<br>
					<br>

					<!-- Test Case Creation -->
					<!-- SHOULD BE VARIABLE (2-6)-->
					<!-- Remove requirement to comma seperate through multiple boxes? -->
					Note: Test case arguments and outputs must be comma seperated <br>
					<div id="testCases">
						<div>
							Test Case 1<br>
							<div name="testCase">
								Arguments:<br>
								<input name="testCaseArgs" type="text"><br>
								Output:<br>
								<input name="testCaseOutput" type="text"><br>
							</div>
							Test Case 2<br>
							<div name="testCase">
								Arguments:<br>
								<input name="testCaseArgs" type="text"><br>
								Output:<br>
								<input name="testCaseOutput" type="text"><br>
							</div>
							Test Case 3<br>
							<div name="testCase">
								Arguments:<br>
								<input name="testCaseArgs" type="text"><br>
								Output:<br>
								<input name="testCaseOutput" type="text"><br>
							</div>
						</div>
					</div>
						
					<div>
						<button type="button" id="submitButton" onclick="SendQuestion()">Submit To Bank</button>
					</div>
				</div>
			</div>
			
		</form>
			
		<form id="examForm" action="">
		
			<!-- Exam Creation -->
			<div class="split right">
				<div class="centered">
					<h1>Exam Creation</h1>
					<br>
					<br>
					
					<div>
						<p>(exam being created goes here)<p>
					</div>
					Total Points
					<p id="totalPoints">0</p>
					<p id="words"></p>
					<button type="button" onclick="SubmitExam()">Submit Exam</button>
					<br>
					
					<label for="questionSearchBox">Search Question Bank</label>
					<div>
							<input id="questionSearchBox" type="text" onchange="QueryQuestions(this.value)"><br>
					<div>
					<div id="queriedQuestions">
						
					</div>
					
					
			
				</div>
			</div>

			
		</form>

	</body>
</html>